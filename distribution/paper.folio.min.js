/*
 *	
 *	folio.js
 *	v0.5
 *	https://github.com/frederickk/folio.js
 *
 *	16. February 2013
 *
 *	Ken Frederick
 *	ken.frederick@gmx.de
 *
 *	http://kennethfrederick.de/
 *	http://blog.kennethfrederick.de/
 *	
 *	
 *	Folio.js is a library for Paper.js http://paperjs.org/. Folio.js
 *	serves as a collection of functions for supporting animations,
 *	rudimentary 3D, additional Path items and lastly a structured
 *	framework/chain of operations similar to that of Processing,
 *	OpenFrameworks, Cinder, et. al. 
 *
 *	Not all of the code in here was created by me
 *	but credit and links are given where credit is due
 *
 *	Additional information and demos can be found here
 *	http://kennethfrederick.de/folio.js/
 *	http://kenfrederick.blogspot.de/2012/12/frederickkpaper.html
 *
 *
 *	This library is free software; you can redistribute it and/or
 *	modify it under the terms of the GNU Lesser General Public
 *	License as published by the Free Software Foundation; either
 *	version 2.1 of the License, or (at your option) any later version.
 *	
 *	http://creativecommons.org/licenses/LGPL/2.1/
 *	
 *	This library is distributed in the hope that it will be useful,
 *	but WITHOUT ANY WARRANTY; without even the implied warranty of
 *	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the GNU
 *	Lesser General Public License for more details.
 *	
 *	You should have received a copy of the GNU Lesser General Public
 *	License along with this library; if not, write to the Free Software
 *	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA	02110-1301	USA
 *	
 */
/*
 *
 *	REQUIRED LIBRARIES!
 *
 *	PaperJs @ http://paperjs.org/
 *	JQuery @	http://jquery.com/download/
 *
 */
var folio=folio||{};var Setup=function(){};var Draw=function(){};var Update=function(a){};var Animate=function(a){};var AnimateClear=function(){};var onMouseUp=function(a){};var onMouseDown=function(a){};var onMouseMove=function(a){};var onMouseDrag=function(a){};var onKeyDown=function(a){};var onKeyUp=function(a){};paper.install(window);window.onload=function(){paper.setup("canvas");console.log("Paper.js is go!");Setup();Draw();var b=new Group();b.name="__AnimationGroup";function a(h,g){if(g==="bottom"){b.appendBottom(h)}else{b.appendTop(h)}}function f(){if(project.activeLayer.children.__AnimationGroup){project.activeLayer.children.__AnimationGroup.remove()}}view.onFrame=function(g){Update(g);f()};view.onResize=function(g){onResize(g)};var d=new Tool();d.onMouseUp=function(g){onMouseUp(g)};d.onMouseDown=function(g){onMouseDown(g)};d.onMouseMove=function(g){onMouseMove(g)};d.onMouseDrag=function(g){onMouseDrag(g)};d.onKeyDown=function(g){onKeyDown(g)};d.onKeyUp=function(g){onKeyUp(g)};view.draw();function c(){var h=document.getElementById("canvas");var m=h.parentNode;if(h.getContext){h.width=m.offsetWidth;h.height=m.offsetHeight}for(var l=0;l<projects.length;l++){for(var g=0;g<projects[l].layers.length;g++){var k=projects[l].layers[g];k.removeChildren()}}Setup();Draw();view.draw()}var e;$(window).resize(function(){clearTimeout(e);e=setTimeout(c,100)});c()};folio={FTime:{},FIO:{},F3D:{},FPath:{},randomBias:function(d,c,a){var e=new Array(90,9,4,2.33,1.5,1,0.66,0.43,0.25,0.11,0.01);a=Math.max(0,Math.min(a,1))*10;var b=parseInt(Math.floor(a));var f=e[b];if(a<10){f+=(e[b+1]-f)*(a-b)}return Math.pow(Math.random(),f)*(c-d)+d},getAngle:function(b,a){return Math.atan2(a.y-b.y,a.x-b.x)*180/Math.PI},getSlopeAngle:function(a){return Math.atan(a.width/a.height)*180/Math.PI},getCommonTangents:function(f,d){var m=d.position.x-f.position.x;var l=d.position.y-f.position.y;var b=Math.sqrt(f.bounds.size.area());var a=Math.sqrt(d.bounds.size.area());b/=2;a/=2;var g=f.position.getDistance(d.position);if(g<=Math.abs(a-b)){return}var e=Math.atan2(l,m);var c=Math.acos((b-a)/g);var k=new Point(f.position.x+b*Math.cos(e+c),f.position.y+b*Math.sin(e+c));var j=new Point(d.position.x+a*Math.cos(e+c),d.position.y+a*Math.sin(e+c));var h=new Point(f.position.x+b*Math.cos(e-c),f.position.y+b*Math.sin(e-c));var i=new Point(d.position.x+a*Math.cos(e-c),d.position.y+a*Math.sin(e-c));return[k,j,i,h]},boolToInt:function(a){return(a)?1:0},getType:function(a){if(a instanceof paper.Point){return"Point"}else{if(a instanceof paper.Size){return"Size"}else{if(a instanceof paper.Rectangle){return"Rectangle"}else{if(a instanceof Group){return"Group"}else{if(a instanceof paper.PlacedItem){return"PlacedItem"}else{if(a instanceof paper.Raster){return"Raster"}else{if(a instanceof paper.PlacedSymbol){return"PlacedSymbol"}else{if(a instanceof paper.Path){return"Path"}else{if(a instanceof paper.CompoundPath){return"CompoundPath"}else{if(a instanceof paper.Symbol){return"Symbol"}else{if(a instanceof paper.TextItem){return"TextItem"}else{return"undefined"}}}}}}}}}}}},findByName:function(a,b){var e;for(var c=0;c<a.length;c++){var d=a[c];if(d.name==b){e=d}}return e},findById:function(a,e){var d;for(var b=0;b<a.length;b++){var c=a[b];if(c.id==e){d=c}}return d},trimToFit:function(a){var b=a.visibleRange.content;a.content=trim(b);return a},rtrim:function(b){for(var a=b.length-1;b.charAt(a)==" ";a--){b=b.substring(0,a)}return b},trim:function(a){a=a.replace(/(^\s*)|(\s*$)/gi,"");a=a.replace(/[ ]{2,}/gi," ");a=a.replace(/\n /,"\n");return a},strToBool:function(a){switch(a.toLowerCase()){case"true":case"yes":case"1":return true;case"false":case"no":case"0":case null:return false;default:return Boolean(a)}},median:function(a){var b=0;a.sort();if(a.length%2===0){b=(a[a.length/2-1]+a[a.length/2])/2}else{b=a[(a.length-1)/2]}return b},unique:function(b){var c=[];o:for(var d=0,f=b.length;d<f;d++){for(var a=0,e=c.length;a<e;a++){if(c[a]==b[d]){continue o}}c[c.length]=b[d]}return c},merge:function(c,b){var a=c.concat(b);a.shuffle();return a},alphabetical:function(d,c){d=d.toLowerCase();d=d.replace(/ä/g,"a");d=d.replace(/ö/g,"o");d=d.replace(/ü/g,"u");d=d.replace(/ß/g,"s");c=c.toLowerCase();c=c.replace(/ä/g,"a");c=c.replace(/ö/g,"o");c=c.replace(/ü/g,"u");c=c.replace(/ß/g,"s");return(d==c)?0:(d>c)?1:-1},distanceToCenter:function(d,c){var g=d.distanceToCenter();console.log(g);var f=c.distanceToCenter();console.log(f);var e=0;if(g>f){e=-1}else{if(g<f){e=1}}return e}};Array.prototype.max=function(f,d){var e=(f!=undefined)?f:0;var b=(d!=undefined)?d:this.length;var a=this[e];for(var c=(e+1);c<b;c++){if(this[c]>a){a=c}}return a};Array.prototype.min=function(f,d){var e=(f!=undefined)?f:0;var a=(d!=undefined)?d:this.length;var c=this[e];for(var b=(e+1);b<a;b++){if(this[b]<c){c=b}}return c};Array.prototype.shuffle=function(){for(var b,a,c=this.length;c;b=parseInt(Math.random()*c),a=this[--c],this[c]=this[b],this[b]=a){}};Array.prototype.removeDuplicates=function(){return this.reduce(function(a,b){if(a.indexOf(b)===-1){a.push(b)}return a},[])};PaperScope.inject({enumerable:true,println:function(a){console.log(a);console.log("\n")},print:function(a){console.log(a)}});paper.Point.inject({snapGrid:function(c){var b,a;b=Math.round(this.y/c.height-this.x/c.width);a=Math.round(this.y/c.height+this.x/c.width);this.x=(a-b)/2*c.width;this.y=(a+b)/2*c.height;return this},snapIso:function(a){if(a===null){a=1}return this.snapGrid(new Size(32*a,16*a))},});paper.Color.inject({componentToHex:function(a){var b=a.toString(16);return b.length==1?"0"+b:b},colorToHex:function(){var e,d,a;var f="";try{e=this.red*255;d=this.green*255;a=this.blue*255;f="#"+this.componentToHex(e)+this.componentToHex(d)+this.componentToHex(a)}catch(c){console.log(c)}return f},colorToInt:function(){var a;try{a=this.red;a=a<<8;a|=this.green;a=a<<8;a|=this.blue}catch(b){console.log(b);a=16777215}return a},integer:function(a){this.red=(a>>16)&255;this.green=(a>>8)&255;this.blue=a&255;return this},bytes:function(d,c,b,a){this.red=d/255;this.green=(c!=undefined)?c/255:d/255;this.blue=(b!=undefined)?b/255:d/255;this.alpha=(a!=undefined)?a/255:1;return this}});paper.Item.inject({snapGrid:function(a){this.position.snapGrid(a)},snapIso:function(a){this.position.snapIso(a)},toGroup:function(){if(folio.getType(this)=="CompoundPath"){return new Group(this.children)}else{return this}}});paper.Path.inject({statics:new function(){return{FArrow:function(f,c,j){var h=new Path(f,c);j=(j!=undefined)?j:new Size(f.getDistance(c)*0.381924,f.getDistance(c)*0.381924);var b=Math.atan2(f.x-c.x,c.y-f.y);var e=[];e[0]=new Path(new Point(0,0),new Point(-j.width,-j.height));e[1]=new Path(new Point(0,0),new Point(j.width,-j.height));for(var d=0;d<e.length;d++){e[d].rotate(180+paper.degrees(b),new Point(0,0));e[d].translate(f)}var g=new Group(h,e[0],e[1]);g.name="arrow";return g},FBubble:function(g,b,i,h){var j=new Path();j.name="bubble";i=(i!=undefined)?i:defaultFBubbleTagSize;if(b.width<10){b.width=10;i=new Size(10,10)}h=(h!=undefined)?h:"RANDOM";j.add(new Point(0,0));var d=180;var a=new Point(b.height/2+Math.cos(paper.radians(d))*(b.height),b.height/2+Math.sin(paper.radians(d))*(b.height));j.arcTo(a,new Point(0,b.height));var c=paper.randomInt(0,b.width-i.width);j.add(new Point(c,b.height));var f,e;if(h=="LEFT"){f=c}else{if(h=="CENTER"){f=c+(i.width/2)}else{if(h=="RIGHT"){f=c+i.width}else{f=paper.randomInt(c,c+i.width)}}}e=b.height+i.height;j.add(new Point(f,e));j.add(new Point(c+i.width,b.height));j.add(new Point(b.width,b.height));d=0;a=new Point(b.height/2+Math.cos(paper.radians(d))*(b.height/2),b.height/2+Math.sin(paper.radians(d))*(b.height/2));j.arcTo(new Point(b.width,0),false);j.closed=true;j.position=new Point(g.x,g.y+(i.height/2));return j},FChain:function(h,g,f,e){var d,c;if(h.type=="Point"){d=new Path.Circle(h,g);c=new Path.Circle(f,e)}else{d=h;c=g}var i=folio.getCommonTangents(d,c);var j=new Path();if(i!=null){j.name="chain";j.add(i[0]);j.add(i[1]);if(c.position.x>d.position.x){angle=0}else{if(c.position.y<d.position.y){angle=-90}else{if(c.position.y>d.position.y){angle=90}else{angle=180}}}var a=new Point(c.position.x+Math.cos(paper.radians(angle))*(c.bounds.width/2),c.position.y+Math.sin(paper.radians(angle))*(c.bounds.height/2));j.arcTo(a,i[2]);j.add(i[2]);j.add(i[3]);if(d.position.x>c.position.x){angle=0}else{if(d.position.y<c.position.y){angle=-90}else{if(d.position.y>c.position.y){angle=90}else{angle=180}}}var b=new Point(d.position.x+Math.cos(paper.radians(angle))*(d.bounds.width/2),d.position.y+Math.sin(paper.radians(angle))*(d.bounds.height/2));j.arcTo(b,i[0]);j.closed}return j},FCross:function(g,d,f,c){(f!=undefined)?f:1;(c!=undefined)?c:"LINE";var b,a;if(c=="LINE"){b=new Path.Line(g.x+d.width,g.y-d.height,g.x-d.width,g.y+d.height);b.strokeWidth=f;a=new Path.Line(g.x+d.width,g.y+d.height,g.x-d.width,g.y-d.height);a.strokeWidth=f}else{if(c=="SHARP"){b=new Path();b.add(g.x+d.width,g.y-d.height);b.add(g.x+d.width,(g.y-d.height)+(f/2));b.add((g.x-d.width)+(f/2),g.y+d.height);b.add(g.x-d.width,g.y+d.height);b.add(g.x-d.width,(g.y+d.height)-(f/2));b.add((g.x+d.width)-(f/2),g.y-d.height);b.closed=true;a=new Path();a.add(g.x-d.width,g.y-d.height);a.add((g.x-d.width)+(f/2),g.y-d.height);a.add(g.x+d.width,(g.y+d.height)-(f/2));a.add(g.x+d.width,g.y+d.height);a.add((g.x+d.width)-(f/2),g.y+d.height);a.add(g.x-d.width,(g.y-d.height)+(f/2));a.closed=true}}var e=new Group(b,a);e.name="cross";return e},FDrop:function(d,a){var c=new Path();c.name="drop";c.add(new Segment(new Point(-0.01,0.01),new Point(0,-0.0055078),new Point(0,0.643042)));c.add(new Segment(new Point(-0.65,1.6381104),new Point(0,-0.6109619),new Point(0,0.3694434)));c.add(new Segment(new Point(0,2.31),new Point(-0.3578369,0),new Point(0.3578369,0)));c.add(new Segment(new Point(0.65,1.6381104),new Point(0,0.3694434),new Point(0,-0.6109619)));c.add(new Segment(new Point(0.01,0.01),new Point(0,0.643042),new Point(0,-0.0055078)));c.add(new Segment(new Point(0,-0),new Point(0.0055078,0),new Point(-0.0055078,0)));c.closed=true;c.position=d;var b=folio.getType(a);if(b=="Size"){c.scale(a.width,a.height)}else{c.scale(a)}return c},FTriangle:function(d,c,a){var b=new Path();b.add(d);b.add(c);b.add(a);b.closed=true;b.name="triangle";return b}}}});folio.FIO={saveLocal:function(a,b){if(window.localStorage){localStorage.setItem(a,String(b))}else{console.error("localStorage not supported")}},getLocal:function(a){return localStorage.getItem(a)},getLocalInt:function(a){return parseInt(getLocal(a))},getLocalFloat:function(a){return parseFloat(getLocal(a))},getAllLocal:function(){return sessionStorage},deleteLocal:function(a){localStorage.removeItem(a)},saveSession:function(a,b){if(window.sessionStorage){sessionStorage.setItem(a,String(b))}else{console.error("sessionStorage not supported")}},getSession:function(a){return sessionStorage.getItem(a)},getSessionInt:function(a){return parseInt(getSession(a))},getSessionFloat:function(a){return parseFloat(getSession(a))},getAllSession:function(){return sessionStorage},deleteSession:function(a){sessionStorage.removeItem(a)},saveCookie:function(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"},openCookie:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null},deleteCookie:function(a){saveCookie(a,"",-1)}};folio.FTime={FDate:{},FStopwatch:{},FStepper:{},Ease:{}};folio.FTime.Ease=function(){var a={ease:[0.25,0.1,0.25,1],linear:[0,0,1,1],out:[0,0,0.58,1],inOut:[0.42,0,0.58,1]};function b(i,h){var k;if(i instanceof Array){k=i}else{i=i.normalize();h=h.normalize();k=[i.x,i.y,h.x,h.y]}function f(n,m){return 1-3*m+3*n}function e(n,m){return 3*m-6*n}function c(m){return 3*m}function d(p,n,m){return((f(n,m)*p+e(n,m))*p+c(n))*p}function l(p,n,m){return 3*f(n,m)*p*p+2*e(n,m)*p+c(n)}function j(q){var n=q;for(var p=0;p<4;++p){var r=l(n,k[0],k[2]);if(r==0){return n}var m=d(n,k[0],k[2])-q;n-=m/r}return n}function g(m){if(k[0]==k[1]&&k[2]==k[3]){return m}return d(j(m),k[1],k[3])}return{get:g}}return{linear:function(c){return c},inQuad:function(c){return c*c},outQuad:function(c){return c*(2-c)},inOutQuad:function(c){return c<0.5?2*c*c:-1+(4-2*c)*c},inCubic:function(c){return c*c*c},outCubic:function(c){return(--c)*c*c+1},inOutCubic:function(c){return c<0.5?4*c*c*c:(c-1)*(2*c-2)*(2*c-2)+1},inQuart:function(c){return c*c*c*c},outQuart:function(c){return 1-(--c)*c*c*c},inOutQuart:function(c){return c<0.5?8*c*c*c*c:1-8*(--c)*c*c*c},inQuint:function(c){return c*c*c*c*c},outQuint:function(c){return 1+(--c)*c*c*c*c},inOutQuint:function(c){return c<0.5?16*c*c*c*c*c:1+16*(--c)*c*c*c*c},inSine:function(c){return -1*Math.cos(c*(Math.PI/2))+1},outSine:function(c){return 1*Math.sin(c*(Math.PI/2))},inOutSine:function(c){return -0.5*(Math.cos(Math.PI*c)-1)},inExpo:function(c){return 1*Math.pow(2,10*(c-1))},outExpo:function(c){return 1*(-Math.pow(2,-10*c)+1)},inOutExpo:function(c){c/=0.5;if(c<1){return 0.5*Math.pow(2,10*(c-1))}c--;return 0.5*(-Math.pow(2,-10*c)+2)},inCirc:function(c){return -1*(Math.sqrt(1-c*c)-1)},outCirc:function(c){c--;return 1*Math.sqrt(1-c*c)},inOutCirc:function(c){c/=0.5;if(c<1){return -0.5*(Math.sqrt(1-c*c)-1)}else{c-=2;return 0.5*(Math.sqrt(1-c*c)+1)}},spline:b}};folio.FTime.FDate=function(){this.date;var b=["January","February","March","April","May","June","July","August","September","October","November","December"];var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var c=function(d){if(d.length==1){d="0"+d}return d};this.year=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getFullYear());return d};this.month=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getMonth());hour=c(d);return d};this.day=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getDate());return d};this.hour=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getHours());d=c(d);return d};this.minute=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getMinutes());d=c(d);return d};this.second=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getSeconds());d=c(d);return d};this.now=function(e){var d=[];if(e===undefined){d=[true,true,true]}else{d=e}var f="";if(d[0]){f+=this.hour()}if(d[0]&&d[1]){f+=":"}if(d[1]){f+=this.minute()}if(d[1]&&d[2]){f+=":"}if(d[2]){f+=this.second()}return f};this.nowMilliseconds=function(){return this.toMillsecond(this.hour(),this.minute(),this.second())};this.add=function(d,g,e,f){return this.date+(24*d+60*g+60*e+1000*s)};this.sub=function(d,g,e,f){return this.date-(24*d+60*g+60*e+1000*s)};this.set=function(d,g,e,f){this.time=new Date();this.time.setTime((24*d+60*g+60*e+1000*s));return this.time};this.get=function(d,k){var l;if(k===undefined){l=new Array(true,true,true)}else{l=k}var j=parseInt((d/1000)%60);var g=parseInt(((d/1000)/60)%60);var i=parseInt((((d/1000)/60)/60)%24);var e,f,m;if(i<10){e="0"+i}else{e=""+i}if(g<10){f="0"+g}else{f=""+g}if(j<10){m="0"+j}else{m=""+j}var h="";if(l[0]){h+=e}if(l[0]&&l[1]){h+=":"}if(l[1]){h+=f}if(l[1]&&l[2]){h+=":"}if(l[2]){h+=m}return h};this.toMillsecond=function(j,e,i){var g,d,f;if(e===undefined&&i===undefined){g=this.toArray(j)[0];d=this.toArray(j)[1];f=this.toArray(j)[2]}else{g=j;d=e;f=i}return parseInt(3600000*g+60000*d+1000*f)};this.toArray=function(d){var e=d.split(":");return[e[0],e[1],e[2]]}};folio.FTime.FStepper=function(){var e=1000;var f=0;var h=0;var j=0;var i=false;var c=false;var g=false;var d=true;var a=0.05;var b=true;this.delta=1;this.counter=-1;this.toggle=function(){if(j==0){j=1;this.stepOut()}else{j=0;this.stepIn()}};this.update=function(k){if(i){i=false;f=k;if(c){h=paper.roundDecimal((k+((1-this.delta)*e)),3)}else{h=paper.roundDecimal((k+(this.delta*e)),3)}if(h<=k){if(c){c=false;this.delta=1}else{g=false;this.delta=0}}}if(c){this.delta=paper.roundDecimal((1-((h-k)/e)),3);if(k==h){c=false;this.delta=1;this.counter++;return}}else{if(g){this.delta=paper.roundDecimal(((h-k)/e),3);if(k==h){c=false;this.delta=0;this.counter++;return}}}};this.stepIn=function(){if(c){return}if(this.delta==1){return}i=true;c=true;g=false};this.stepOut=function(){if(g){return}if(this.delta==0){return}i=true;g=true;c=false};this.isIn=function(){return c};this.isOut=function(){return g};this.isDone=function(){if(this.delta<1&&this.delta>0){return false}else{if(this.delta>1){this.delta=1;return true}else{if(this.delta<0){this.delta=0;return true}}}};this.stop=function(){i=c=g=false};this.setSeconds=function(k){this.setMillis(parseInt(k*1000))};this.setMillis=function(k){e=k;e/=1000};this.setDelta=function(k){this.delta=k}};folio.FTime.FStopwatch=function(){var c;var d;var b=0;var a=0;this.toggle=function(){if(a==0){this.start()}else{this.pause()}};this.start=function(){a=1;d=new Date();d.setTime(d.getTime()-b)};this.pause=function(){a=0;c=new Date();b=c.getTime()-d.getTime()};this.reset=function(){a=0;b=0};this.set=function(e,f){b=e;(f==true)?a=0:a=1;d=new Date();d.setTime(d.getTime()-b);this.toggle()};this.get=function(){if(a==1){c=new Date();b=c.getTime()-d.getTime()}return b};this.isRunning=function(){return(a)?true:false}};var Matrix3D=function(m,l,j,h,e,d,c,b,a,q,p,n,k,i,g,f){this.n11=m||1;this.n12=l||0;this.n13=j||0;this.n14=h||0;this.n21=e||0;this.n22=d||1;this.n23=c||0;this.n24=b||0;this.n31=a||0;this.n32=q||0;this.n33=p||1;this.n34=n||0;this.n41=k||0;this.n42=i||0;this.n43=g||0;this.n44=f||1;this.clone=function(){return new Matrix3D(this.n11,this.n12,this.n13,this.n14,this.n21,this.n22,this.n23,this.n24,this.n31,this.n32,this.n33,this.n34,this.n41,this.n42,this.n43,this.n44)};this.concat=function(r){var t={};t.n11=this.n11*r.n11+this.n12*r.n21+this.n13*r.n31+this.n14*r.n41;t.n12=this.n11*r.n12+this.n12*r.n22+this.n13*r.n32+this.n14*r.n42;t.n13=this.n11*r.n13+this.n12*r.n23+this.n13*r.n33+this.n14*r.n43;t.n14=this.n11*r.n14+this.n12*r.n24+this.n13*r.n34+this.n14*r.n44;t.n21=this.n21*r.n11+this.n22*r.n21+this.n23*r.n31+this.n24*r.n41;t.n22=this.n21*r.n12+this.n22*r.n22+this.n23*r.n32+this.n24*r.n42;t.n23=this.n21*r.n13+this.n22*r.n23+this.n23*r.n33+this.n24*r.n43;t.n24=this.n21*r.n14+this.n22*r.n24+this.n23*r.n34+this.n24*r.n44;t.n31=this.n31*r.n11+this.n32*r.n21+this.n33*r.n31+this.n34*r.n41;t.n32=this.n31*r.n12+this.n32*r.n22+this.n33*r.n32+this.n34*r.n42;t.n33=this.n31*r.n13+this.n32*r.n23+this.n33*r.n33+this.n34*r.n43;t.n34=this.n31*r.n14+this.n32*r.n24+this.n33*r.n34+this.n34*r.n44;t.n41=this.n41*r.n11+this.n42*r.n21+this.n43*r.n31+this.n44*r.n41;t.n42=this.n41*r.n12+this.n42*r.n22+this.n43*r.n32+this.n44*r.n42;t.n43=this.n41*r.n13+this.n42*r.n23+this.n43*r.n33+this.n44*r.n43;t.n44=this.n41*r.n14+this.n42*r.n24+this.n43*r.n34+this.n44*r.n44;this.initialize(t)};this.initialize=function(r){for(var t in r){this[t]=r[t]}};this.createBox=function(A,y,w,u,t,r,z,x,v){this.identity();if(u!=0){this.rotateX(u)}if(t!=0){this.rotateY(t)}if(r!=0){this.rotateZ(r)}if(A!=1||y!=1||w!=1){this.scale(A,y,w)}if(z!=0||x!=0||v!=0){this.translate(z,x,v)}};this.identity=function(){this.initialize({n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1})};this.rotateX=function(u){var r=Math.sin(u);var t=Math.cos(u);this.concat(new Matrix3D(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1))};this.rotateY=function(u){var r=Math.sin(u);var t=Math.cos(u);this.concat(new Matrix3D(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1))};this.rotateZ=function(u){var r=Math.sin(u);var t=Math.cos(u);this.concat(new Matrix3D(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1))};this.setRotateAxis=function(r,u){var E=Math.cos(u);var B=Math.sin(u);var F=1-E;var D=r.x();var C=r.y();var A=r.z();var w=F*D;var v=F*C;this.concat(w*D+E,w*C-B*A,w*A+B*C,0,w*C+B*A,v*C+E,v*A-B*D,0,w*A-B*C,v*A+B*D,F*A*A+E,0,0,0,0,1)};this.scale=function(u,t,r){this.concat(new Matrix3D(u,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1))};this.translate=function(u,t,r){this.n41+=u;this.n42+=t;this.n43+=r};this.transformPoint=function(r){return new Vertex3D(this.n11*r.x+this.n21*r.y+this.n31*r.z+this.n41,this.n12*r.x+this.n22*r.y+this.n32*r.z+this.n42,this.n13*r.x+this.n23*r.y+this.n33*r.z+this.n43)};this.transformArray=function(t){var w=[];var A=t.length/3;for(var v=0;v<A;v++){var u=v*3;var r=t[u];var C=t[u+1];var B=t[u+2];w[u]=this.n11*r+this.n21*C+this.n31*B+this.n41;w[u+1]=this.n12*r+this.n22*C+this.n32*B+this.n42;w[u+2]=this.n13*r+this.n23*C+this.n33*B+this.n43}return w};this.getPosition=function(){return[this.n12,this.n13,this.n14]};this.setPosition=function(r){this.n12=r.x;this.n13=r.y;this.n14=r.z;return this},this.makeFrustum=function(t,F,r,C,v,u){var G={};var E=2*v/(F-t);var B=2*v/(C-r);var D=(F+t)/(F-t);var A=(C+r)/(C-r);var z=-(u+v)/(u-v);var w=-2*u*v/(u-v);G.n11=E;G.n12=0;G.n13=D;G.n14=0;G.n21=0;G.n22=B;G.n23=A;G.n24=0;G.n31=0;G.n32=0;G.n33=z;G.n34=w;G.n41=0;G.n42=0;G.n43=-1;G.n44=0;this.concat(G)};this.makePerspective=function(w,u,y,t){var r=y*Math.tan(w*Math.PI/360);var x=-r;var z=x*u;var v=r*u;this.makeFrustum(z,v,x,r,y,t)};this.makeOrtho=function(u,H,E,r,B,A){var I={};var G=H-u;var v=E-r;var t=A-B;var F=(H+u)/G;var D=(E+r)/v;var C=(A+B)/t;I.n11=2/G;I.n12=0;I.n13=0;I.n14=-F;I.n21=0;I.n22=2/v;I.n23=0;I.n24=-D;I.n31=0;I.n32=0;I.n33=-2/t;I.n34=-C;I.n41=0;I.n42=0;I.n43=0;I.n44=1;this.concat(I)};this.toString=function(){return this.n11+","+this.n12+","+this.n13+","+this.n14+","+this.n21+","+this.n22+","+this.n23+","+this.n24+","+this.n31+","+this.n32+","+this.n33+","+this.n34+","+this.n41+","+this.n42+","+this.n43+","+this.n44}};folio.F3D={FScene3:{},FPoint3:{},FSize3:{},FPath3:function(){},};folio.F3D.FPath3=Path.extend({_class:"FPath3",_serializeFields:{segments:[],closed:false,scene:null,matrix:null,size:null,position3:null,fpoints3:[],rotation:null,translation:null},initialize:function FPath3(a){this._closed=false;this._segments=[];this._scene=a;this._matrix=new Matrix3D();this._size=new folio.F3D.FSize3();this._position3=new folio.F3D.FPoint3();this._fpoints3=[];this._rotation=new folio.F3D.FPoint3();this._translation=new folio.F3D.FPoint3();this.name="FPath3";Path.call(this);this._initialize()},setScene:function(b){this._scene=b;for(var a=0;a<this._fpoints3.length;a++){this._fpoints3[a].setup(this._scene)}},add3:function(a){this._fpoints3[this._fpoints3.length]=a},translate:function(d,b,a){if(typeof d=="number"){this._translation.x=d;this._translation.y=b;this._translation.z=a}else{if(typeof d=="object"){this._translation.x=d.x;this._translation.y=d.y;this._translation.z=d.z}else{this._translation.x=(d!=undefined)?d:0;this._translation.y=(b!=undefined)?b:0;this._translation.z=(a!=undefined)?a:0}}for(var c=0;c<this._fpoints3.length;c++){var e=this._fpoints3[c];e.setX((e.x+this._translation.x));e.setY((e.y+this._translation.y));e.setZ((e.z+this._translation.z))}},rotateX:function(a){this._rotation.x=a},rotateY:function(a){this._rotation.y=a},rotateZ:function(a){this._rotation.z=a},get:function(){this._segments=[];for(var a=0;a<this._fpoints3.length;a++){var b=this._fpoints3[a];this.add(new Point(b.x2D(),b.y2D()))}return this},});folio.F3D.FPath3.inject({statics:new function(){return{FBox:function(m,q,b){this._position3=(q!=undefined)?q:new folio.F3D.FPoint3(0,0,0);this._size=(b!=undefined)?b:new folio.F3D.FSize3(10,10,10);var e=new Array(6);var h=[new folio.F3D.FPoint3(-0.5,-0.5,-0.5),new folio.F3D.FPoint3(0.5,-0.5,-0.5),new folio.F3D.FPoint3(0.5,0.5,-0.5),new folio.F3D.FPoint3(-0.5,0.5,-0.5)],l=[new folio.F3D.FPoint3(-0.5,-0.5,0.5),new folio.F3D.FPoint3(0.5,-0.5,0.5),new folio.F3D.FPoint3(0.5,-0.5,-0.5),new folio.F3D.FPoint3(-0.5,-0.5,-0.5)],p=[new folio.F3D.FPoint3(-0.5,0.5,0.5),new folio.F3D.FPoint3(0.5,0.5,0.5),new folio.F3D.FPoint3(0.5,0.5,-0.5),new folio.F3D.FPoint3(-0.5,0.5,-0.5)],c=[new folio.F3D.FPoint3(-0.5,-0.5,-0.5),new folio.F3D.FPoint3(-0.5,-0.5,0.5),new folio.F3D.FPoint3(-0.5,0.5,0.5),new folio.F3D.FPoint3(-0.5,0.5,-0.5)],a=[new folio.F3D.FPoint3(0.5,-0.5,-0.5),new folio.F3D.FPoint3(0.5,-0.5,0.5),new folio.F3D.FPoint3(0.5,0.5,0.5),new folio.F3D.FPoint3(0.5,0.5,-0.5)],f=[new folio.F3D.FPoint3(-0.5,-0.5,0.5),new folio.F3D.FPoint3(0.5,-0.5,0.5),new folio.F3D.FPoint3(0.5,0.5,0.5),new folio.F3D.FPoint3(-0.5,0.5,0.5)];var d=[["front",h],["top",l],["bottom",p],["left",c],["right",a],["back",f]];var n=[];for(var k=0;k<d.length;k++){e[k]=new folio.F3D.FPath3();e[k].name="Z-TOP";n=d[k][1];for(var g=0;g<n.length;g++){e[k].add3(new folio.F3D.FPoint3(n[g].x*this._size.width,n[g].y*this._size.height,n[g].z*this._size.depth))}e[k].closed=true;e[k].translate(q);m.addItem(e[k])}return new Group(e)},FSphere:function(u,n,b,v){this._position3=(n!=undefined)?n:new folio.F3D.FPoint3(0,0,0);this._size=(b!=undefined)?new folio.F3D.FSize3(b,b,b):new folio.F3D.FSize3(10,10,10);var d=0.5;var p;if(v!=undefined){if(v instanceof Array){p=v}else{p=[v,v]}}else{p=[6,6]}var g=[];for(var r=0;r<=p[0];r++){var c=(Math.PI*(-d+((r-1)/p[0])));var m=Math.sin(c);var f=Math.cos(c);var a=(Math.PI*(-d+(r/p[0])));var l=Math.sin(a);var e=Math.cos(a);for(var q=0;q<=p[1];q++){var w=((Math.PI*2)*((q-1)/p[1]));var k=Math.cos(w);var h=Math.sin(w);g.push(new folio.F3D.FPoint3(k*f,h*f,m));g.push(new folio.F3D.FPoint3(k*e,h*e,l))}}var t=new Array(g.length-2);for(var r=0;r<g.length-2;r++){t[r]=new folio.F3D.FPath3();t[r].name="face"+r;t[r].add3(new folio.F3D.FPoint3(g[r].x*(this._size.width*0.5),g[r].y*(this._size.height*0.5),g[r].z*(this._size.depth*0.5)));t[r].add3(new folio.F3D.FPoint3(g[r+1].x*(this._size.width*0.5),g[r+1].y*(this._size.height*0.5),g[r+1].z*(this._size.depth*0.5)));t[r].add3(new folio.F3D.FPoint3(g[r+2].x*(this._size.width*0.5),g[r+2].y*(this._size.height*0.5),g[r+2].z*(this._size.depth*0.5)));t[r].closed=true;t[r].translate(n);u.addItem(t[r])}return new Group(t)}}}});folio.F3D.FPoint3=this.FPoint3=function(e,d,c){var g=null;var f=0;var i=0;var a=0;var h=0;var b=0;this.x=e!=undefined?e:0;this.y=d!=undefined?d:0;this.z=c!=undefined?c:0;this.setup=function(m){g=m;var j=g.setupPoint(this.x,this.y,this.z);var k=j*3;var l=j*2;f=k;i=k+1;a=k+2;h=l;b=l+1};this.random=function(k,n,j,m,p,l){k=(k!=undefined)?k:0;n=(n!=undefined)?n:view.bounds.width;j=(j!=undefined)?j:0;m=(m!=undefined)?m:view.bounds.height;p=(p!=undefined)?j:0;l=(l!=undefined)?m:1000;this.x=paper.random(k,n);this.y=paper.random(j,m);this.z=paper.random(p,l);return new folio.F3D.FPoint3(this.x,this.y,this.z)};this.setX=function(j){if(g!=null){g.points3D[f]=j}this.x=j};this.setY=function(j){if(g!=null){g.points3D[i]=j}this.y=j};this.setZ=function(j){if(g!=null){g.points3D[a]=j}this.z=j};this.set=function(l,k,j){this.setX(l);this.setY(k);this.setZ(j)};this.get=function(){return new folio.F3D.FPoint3(this.x,this.y,this.z)};this.x2D=function(){return g.points2D[h]};this.y2D=function(){return g.points2D[b]};this.getSceneIndex=function(){return _sceneIndex};this.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};this.add=function(l,k,j){if(typeof l=="number"){this.x+=l;this.y+=k;this.z+=j}else{if(typeof l=="object"){this.x+=l.x();this.y+=l.y();this.z+=l.z()}}this.set(this.x,this.y,this.z)};this.sub=function(l,k,j){if(typeof l=="number"){this.x-=l;this.y-=k;this.z-=j}else{if(typeof l=="object"){this.x-=l.x();this.y-=l.y();this.z-=l.z()}}this.set(this.x,this.y,this.z)};this.scale=function(j){this.x*=j;this.y*=j;this.z*=j;this.set(this.x,this.y,this.z)};this.mult=function(l,k,j){if(typeof l=="number"){this.x*=l;this.y*=k;this.z*=j}else{if(typeof l=="object"){this.x*=l.x();this.y*=l.y();this.z*=l.z()}}this.set(this.x,this.y,this.z)};this.div=function(l,k,j){if(typeof l=="number"){this.x/=l;this.y/=k;this.z/=j}else{if(typeof l=="object"){this.x/=l.x();this.y/=l.y();this.z/=l.z()}}this.set(this.x,this.y,this.z)};this.getDistance=function(m){var l=this.x-m.x();var k=this.y-m.y();var j=this.z-m.z();return Math.sqrt(l*l+k*k+j*j)};this.angleBetween=function(n,m){var k=n.x()*m.x()+n.y()*m.y()+n.z()*m.z();var l=Math.sqrt(n.x()*n.x()+n.y()*n.y()+n.z()*n.z());var j=Math.sqrt(m.x()*m.x()+m.y()*m.y()+m.z()*m.z());return Math.acos(k/(l*j))};this.normalize=function(){var j=this.mag();if(j!=0&&j!=1){this.div(j)}};this.toString=function(){return"[ "+this.x+", "+this.y+", "+this.z+" ]"};this.array=function(){return[this.x,this.y,this.z]}};folio.F3D.FScene3D=this.FScene3D=function(){var b="PERSPECTIVE";var c=null;var f=new folio.F3D.FSize3(0,0,0);var h=1;var d=new folio.F3D.FPoint3(0,0,0);var g=0;var e=null;var i=null;var j=null;this.bounds=new folio.F3D.FSize3(0,0,0);this.points3D=[];this.points2D=[];this._ortho=function(){c.makeOrtho(-f.height,f.height,f.height,-f.height,-f.height,f.height)};this._perspective=function(){c.makePerspective(50,0.5*this.bounds.width/this.bounds.height,f.depth,this.bounds.depth*2)};this.setup=function(l,k,m,n){this.points3D=[];this.points2D=[];e=[];c=new Matrix3D();this.bounds.width=l||paper.view.bounds.width;this.bounds.height=k||paper.view.bounds.height;this.bounds.depth=m||1000;f.width=this.bounds.width*0.5;f.height=this.bounds.height*0.5;f.depth=this.bounds.depth*0.5;this.setMode(n);i=new Group();j=new Group()};this.draw=function(){c.identity();if(b=="ORTHO"){this._ortho()}else{this._perspective()}c.scale(h,h,h);c.rotateX(d.x);c.rotateY(d.y);c.rotateZ(d.z);c.translate(0,0,this.bounds.depth);var r=c.transformArray(this.points3D);for(var t=0;t<g;t++){var n=t*3;var q=t*2;var A=r[n];var w=r[n+1];var v=r[n+2];var p=this.bounds.depth/(v+this.bounds.depth);this.points2D[q]=A*p+f.width;this.points2D[q+1]=w*p+f.height}var l=0;var u=[];for(var t=0;t<e.length;t++){var k=e[t];var m=this.averageZ(r,l,l+(k._fpoints3.length*3));var B={index:t,z:m};u.push(B);l+=(k._fpoints3.length*3)-1}u.sort(a);i.removeChildren();j.removeChildren();for(var t=0;t<u.length;t++){var C=e[u[t].index].get();if(C.name=="Z-TOP"){j.appendTop(C)}else{if(C.name=="Z-BOTTOM"){i.appendTop(C)}else{if(C!=null){i.appendTop(C)}}}}if(b=="ORTHO"){j.scale(200,i.position);i.scale(200,i.position)}return new Group(i,j)};this.setupPoint=function(m,l,k){var n=g;this.points2D[this.points2D.length]=0;this.points2D[this.points2D.length]=0;this.points3D[this.points3D.length]=m;this.points3D[this.points3D.length]=l;this.points3D[this.points3D.length]=k;g++;return n};this.averageZ=function(q,p,n){var k=0;for(var m=p;m<n;m+=2){k+=parseInt(q[m+2])}var l=(n-p)/3;return k/l};function a(l,k){if(l.z<k.z){return -1}if(l.z>k.z){return 1}return 0}this.setMode=function(k){b=k!=undefined?k:"PERSPECTIVE"};this.addItem=function(l){if(l.length>0){for(var k=0;k<l.length;k++){e[e.length]=l[k];l[k].setScene(this)}}else{e[e.length]=l;l.setScene(this)}};this.rotateX=function(k){d.setX(k)};this.rotateY=function(k){d.setY(k)};this.rotateZ=function(k){d.setZ(k)};this.get=function(){return i};this.getBounds=function(){return[this.bounds.width,this.bounds.height,this.bounds.depth]};this.getMatrix=function(){return c};this.getFocalLength=function(){return this.bounds.depth};this.getScale=function(){return h}};folio.F3D.FSize3=this.FSize3=function(c,b,a){this.width=c!=undefined?c:0;this.height=b!=undefined?b:0;this.depth=a!=undefined?a:0;this.setWidth=function(d){this.width=d};this.setHeight=function(d){this.height=d};this.setDepth=function(d){this.depth=d};this.set=function(f,e,d){this.setWidth(f);this.setHeight(e);this.setDepth(d)};this.get=function(){return new folio.F3D.FSize3(this.width,this.height,this.depth)};this.random=function(d,i,f,e,h,g){d=(d!=undefined)?d:0;i=(i!=undefined)?i:view.bounds.width;f=(f!=undefined)?f:0;e=(e!=undefined)?e:view.bounds.height;h=(h!=undefined)?h:0;g=(g!=undefined)?g:1000;this.width=paper.random(d,i);this.height=paper.random(f,e);this.depth=paper.random(h,g);return this};this.volume=function(){return(this.width*this.height*this.depth)}};folio.TSP=function(a,d){var a=a;var d=(d!=undefined)?d:1000;var b=0;var e=[];function c(){var D;var g;if(b==0){var t=0;var n=new Array(a.length);for(var A=0;A<a.length;++A){n[A]=false;var v=a[A].position.x;var u=a[A].position.y;if((v>=view.bounds.width)||(u>=view.bounds.height)||(v<0)||(u<0)){continue}else{n[A]=true;t++}}e=new Array(t);var C=0;for(var A=0;A<a.length;++A){if(n[A]){e[C]=A;C++}}}var w=e.length-1;if(b<(e.length-2)){var E=b+1000;if(E>w){E=w}for(var A=b;A<E;++A){g=a[e[b]].position;var B=0;var h=Number.MAX_VALUE;for(var z=b+1;z<w;++z){var f=a[e[z]].position;var r=g.x-f.x;var q=g.y-f.y;var k=(r*r+q*q);if(k<h){B=z;h=k}}D=e[b+1];e[b+1]=e[B];e[B]=D;if(b<(w)){b++}else{console.log("Now optimizing plot path")}}}for(var A=0;A<d;++A){var G=Math.floor(random(0,w));var F=Math.floor(random(0,w));if(Math.abs(G-F)<2){continue}if(F<G){D=F;F=G;G=D}var I=a[e[G]].position;var H=a[e[G+1]].position;var p=a[e[F]].position;var m=a[e[F+1]].position;var r=I.x-H.x;var q=I.y-H.y;var k=(r*r+q*q);r=p.x-m.x;q=p.y-m.y;k+=(r*r+q*q);r=I.x-p.x;q=I.y-p.y;var x=(r*r+q*q);r=H.x-m.x;q=H.y-m.y;x+=(r*r+q*q);if(x<k){var l=F;var y=G+1;while(l>y){D=e[y];e[y]=e[l];e[l]=D;l--;y++}}}}c();return{route:e}};var EPSILON=0.000001;folio.Triangle=function(m,k,j){var g=m;var f=k;var e=j;function h(p){return m==p.p1||m==p.p2||m==p.p3||k==p.p1||k==p.p2||k==p.p3||j==p.p1||j==p.p2||j==p.p3}function n(){var v=new Point();var q,p;var t,r;var w,u;if(Math.abs(f.y-g.y)<EPSILON){p=-(e.x-f.x)/(e.y-f.y);r=(f.x+e.x)/2;u=(f.y+e.y)/2;v.x=(f.x+g.x)/2;v.y=p*(v.x-r)+u}else{if(Math.abs(e.y-f.y)<EPSILON){q=-(f.x-g.x)/(f.y-g.y);t=(g.x+f.x)/2;w=(g.y+f.y)/2;v.x=(e.x+f.x)/2;v.y=q*(v.x-t)+w}else{q=-(f.x-g.x)/(f.y-g.y);p=-(e.x-f.x)/(e.y-f.y);t=(g.x+f.x)/2;r=(f.x+e.x)/2;w=(g.y+f.y)/2;u=(f.y+e.y)/2;v.x=(q*t-p*r+u-w)/(q-p);v.y=q*(v.x-t)+w}}return v}function c(){return new Point((g.x+f.x+e.x)/3,(g.y+f.y+e.y)/3)}function i(){var p=[];p[0]=new folio.Edge(g,f);p[1]=new folio.Edge(g,e);p[2]=new folio.Edge(e,f);p.sort();return p}function b(){var q=0;if(g.x<f.x&&g.x<e.x){q=g.x}else{if(f.x<g.x&&f.x<e.x){q=f.x}else{if(e.x<g.x&&e.x<f.x){q=e.x}}}var p=0;if(g.x>f.x&&g.x>e.x){p=g.x}else{if(f.x>g.x&&f.x>e.x){p=f.x}else{if(e.x>g.x&&e.x>f.x){p=e.x}}}var r=Math.abs(p-q);return r}function l(){var q=0;if(g.y<f.y&&g.y<e.y){q=g.y}else{if(f.y<g.y&&f.y<e.y){q=f.y}else{if(e.y<g.y&&e.y<f.y){q=e.y}}}var p=0;if(g.y>f.y&&g.y>e.y){p=g.y}else{if(f.y>g.y&&f.y>e.y){p=f.y}else{if(e.y>g.y&&e.y>f.y){p=e.y}}}var r=Math.abs(p-q);return r}function a(){var p=0;p+=(g.x+e.x)*(e.y-g.y);p+=(f.x+g.x)*(g.y-f.y);p+=(e.x+f.x)*(f.y-e.y);return p/2}function d(){var p=[g,f,e];return p}return{p1:g,p2:f,p3:e,sharesVertex:h,getCentroid:c,getArea:a,getWidth:b,getHeight:l,getPoints:d}};folio.Edge=function(g,f){var d=g;var a=f;var e=d.getDistance(a);function c(h){return e<h.dist?-1:e>h.dist?1:0}function b(){var h=[d,a];return h}return{p1:d,p2:a,dist:e,getPoints:b}};folio.Triangulate=function(l){var c;var d=l;var n=[];function m(){c=[];if(d.length!=null){d=i(d);d.sort(e);var C=(d[0]).x;var H=(d[0]).y;var E=C;var L=H;var w=(d[0]).z;for(var J=0;J<d.length;J++){var D=d[J];if(D.x<C){C=D.x}if(D.x>E){E=D.x}if(D.y<H){H=D.y}if(D.y>L){L=D.y}}var y=E-C;var x=L-H;var F=(y>x)?y:x;var K=(E+C)/2;var P=(L+H)/2;c=[];var B=new HashSet();var N=new folio.Triangle(new Point(K-2*F,P-F),new Point(K,P+2*F),new Point(K+2*F,P-F));c.push(N);var q=[];for(var J=0;J<d.length;J++){var D=d[J];q=[];var r=new Point();for(var I=c.length-1;I>=0;I--){var A=c[I];if(B.contains(A)){continue}var M=b(D,A,r);if(r.x+r.z<D.x){B.add(A)}if(M){q.push(new folio.Edge(A.p1,A.p2));q.push(new folio.Edge(A.p2,A.p3));q.push(new folio.Edge(A.p3,A.p1));c.splice(I,1)}}q=g(q);for(var I=0;I<q.length-1;I++){var v=q[I];for(var G=I+1;G<q.length;G++){var u=q[G];if(v.p1==u.p2&&v.p2==u.p1){v.p1=null;v.p2=null;u.p1=null;u.p2=null}if(v.p1==u.p1&&v.p2==u.p2){v.p1=null;v.p2=null;u.p1=null;u.p2=null}}}for(var I=0;I<q.length;I++){var O=q[I];if(O.p1==null||O.p2==null){continue}for(var G=0;G<n.length;G++){if(O.p1==n[G]){O.p1.name="__new"}else{O.p1.name=null}if(O.p2==n[G]){O.p2.name="__new"}else{O.p2.name=null}if(D==n[G]){D.name="__new"}else{D.name=null}}c.push(new folio.Triangle(O.p1,O.p2,D))}}for(var J=c.length-1;J>=0;J--){var A=c[J];if(A.sharesVertex(N)){c.splice(J,1)}}}}function b(r,B,q){var C,z;var y,x;var w,v;var E,A;var D;var u;if(Math.abs(B.p1.y-B.p2.y)<EPSILON&&Math.abs(B.p2.y-B.p3.y)<EPSILON){return false}if(Math.abs(B.p2.y-B.p1.y)<EPSILON){z=-(B.p3.x-B.p2.x)/(B.p3.y-B.p2.y);x=(B.p2.x+B.p3.x)/2;v=(B.p2.y+B.p3.y)/2;q.x=(B.p2.x+B.p1.x)/2;q.y=z*(q.x-x)+v}else{if(Math.abs(B.p3.y-B.p2.y)<EPSILON){C=-(B.p2.x-B.p1.x)/(B.p2.y-B.p1.y);y=(B.p1.x+B.p2.x)/2;w=(B.p1.y+B.p2.y)/2;q.x=(B.p3.x+B.p2.x)/2;q.y=C*(q.x-y)+w}else{C=-(B.p2.x-B.p1.x)/(B.p2.y-B.p1.y);z=-(B.p3.x-B.p2.x)/(B.p3.y-B.p2.y);y=(B.p1.x+B.p2.x)/2;x=(B.p2.x+B.p3.x)/2;w=(B.p1.y+B.p2.y)/2;v=(B.p2.y+B.p3.y)/2;q.x=(C*y-z*x+v-w)/(C-z);q.y=C*(q.x-y)+w}}E=B.p2.x-q.x;A=B.p2.y-q.y;D=E*E+A*A;q.z=Math.sqrt(D);E=r.x-q.x;A=r.y-q.y;u=E*E+A*A;return u<=D}function j(q){var p;for(var u=0;u<c.length;u++){var x=c[u];var w=q.getCentroid.getDistance(x.getCentroid);for(var r=0;r<c.length;r++){var t=c[r];var v=q.getCentroid.getDistance(t.getCentroid);if(v<w){p=t;break}}}return p}function e(q,p){if(q.x<p.x){return 1}else{if(q.x>p.x){return -1}else{return 0}}}function h(q,p){if(q.y<p.y){return 1}else{if(q.y>p.y){return -1}else{return 0}}}function i(p){p.sort();for(var q=1;q<p.length;){if(p[q-1].x==p[q].x&&p[q-1].y==p[q].y){p.splice(q,1)}else{q++}}return p}function g(p){p.sort();for(var q=1;q<p.length;){if(p[q-1].p1==p[q].p1&&p[q-1].p2==p[q].p2||p[q-1].p1==p[q].p2&&p[q-1].p2==p[q].p2){p.splice(q,1)}else{q++}}return p}function a(p){n=[];if(p instanceof Array){n=p;d=d.concat(p)}else{n[0]=p;d.push(p)}d=i(d);m()}function k(p){if(p!=null){return c[p]}else{return c}}function f(p){if(p!=null){return d[p]}else{return d}}m();return{add:a,getTriangles:k,getPoints:f,getClosest:j}};var HashSet=function(){var a=new Array();function g(k){var h=a;var j=h.indexOf(k);if(j==-1){h.push(k)}}function d(h){return a[h]}function b(h){return a.length}function c(k){var h=a;var j=h.indexOf(k);if(j!=-1){h.splice(j,1)}}function e(k){var h=false;for(var j=0;j<a.length;j++){if(a[j]===k){h=true}}return h}function f(){return a.join(",")}return{add:g,get:d,size:b,remove:c,contains:e,toString:f}};paper.Point.inject({name:null,data:{}});