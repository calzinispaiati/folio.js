/*
 *	
 *	folio.js
 *	v0.5
 *	https://github.com/frederickk/folio.js
 *
 *	11. August 2013
 *
 *	Ken Frederick
 *	ken.frederick@gmx.de
 *
 *	http://kennethfrederick.de/
 *	http://blog.kennethfrederick.de/
 *	
 *	
 *	Folio.js is a library for Paper.js http://paperjs.org/. Folio.js
 *	serves as a collection of functions for supporting animations,
 *	rudimentary 3D, additional Path items and lastly a structured
 *	framework/chain of operations similar to that of Processing,
 *	OpenFrameworks, Cinder, et. al. 
 *
 *	Not all of the code in here was created by me
 *	but credit and links are given where credit is due
 *
 *	Additional information and demos can be found here
 *	http://kennethfrederick.de/folio.js/
 *	http://kenfrederick.blogspot.de/2012/12/frederickkpaper.html
 *
 *
 *	This library is free software; you can redistribute it and/or
 *	modify it under the terms of the GNU Lesser General Public
 *	License as published by the Free Software Foundation; either
 *	version 2.1 of the License, or (at your option) any later version.
 *	
 *	http://creativecommons.org/licenses/LGPL/2.1/
 *	
 *	This library is distributed in the hope that it will be useful,
 *	but WITHOUT ANY WARRANTY; without even the implied warranty of
 *	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the GNU
 *	Lesser General Public License for more details.
 *	
 *	You should have received a copy of the GNU Lesser General Public
 *	License along with this library; if not, write to the Free Software
 *	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA	02110-1301	USA
 *	
 */
var artboard=activeDocument.activeArtboard;var view=artboard;var raster;var paper=PaperScope=global;script.coordinateSystem="top-down";script.angleUnits="degrees";global.inject({enumerable:true,EPSILON:0.000001,FRAMERATE:12,_event:{count:0,time:0,delta:0},println:function(a){console.log(a);console.log("\n")},Animate:function(d,b){b=(b===undefined)?FRAMERATE:b;var a=parseInt((1/b)*1000);if(d){var c=setInterval(function(){onFrame(a,Update)},a)}},onFrame:function(a,c){a=(a===undefined)?2:a;_event.count++;_event.time+=(a*0.001);_event.delta-=_event.time;try{c(_event)}catch(b){}_event.delta=_event.time},random:function(b,a){if(a===undefined){a=b;b=0}return(b+Math.random()*(a-b))},randomInt:function(b,a){return parseInt(this.random(b,a))},clamp:function(c,b,a){return(c<b)?b:((c>a)?a:c)},norm:function(b,c,a){return(b-c)/(a-c)},map:function(d,b,c,a,e){return a+(e-a)*((d-b)/(c-b))},roundDecimal:function(c,a){var b=Math.pow(10,a);return Math.round(c*b)/b},snap:function(c,a,b){if(b===undefined){b=Math.round}return this.round(a*b(c/a),2)},interpolate:function(c,a,b){return c+(a-c)*b},degrees:function(a){return a*(180/Math.PI)},radians:function(a){return a*(Math.PI/180)},sec:function(a){return 1/Math.cos(a)},cosec:function(a){return 1/Math.sin(a)},sq:function(a){return a*a},slope:function(a){}});var Conversions=new function(){return{PIXEL_TO_MM:0.352777778,MM_TO_PIXEL:2.83464567,PIXEL_TO_CM:0.0352777778,CM_TO_PIXEL:28.3464567,PIXEL_TO_INCH:0.0138888889,INCH_TO_PIXEL:72,PIXEL_TO_PICA:0.0833333333,PICA_TO_PIXEL:12}};paper.Point.inject({interpolateTo:function(a,b){this.x+=((a.x-this.x)*b);this.y+=((a.y-this.y)*b);return this},interpolate:function(c,b,a){if(typeof b==="number"){return new Point(paper.interpolate(this.x,c.x,b),paper.interpolate(this.y,c.y,b))}else{return new Point(paper.interpolate(c.x,b.x,a),paper.interpolate(c.y,b.y,a))}},getDistanceToCenter:function(){return this.getDistance(view.bounds.center)},norm:function(b,a){this.x=paper.norm(this.x,b.x,a.x);this.y=paper.norm(this.y,b.y,a.y);return this},getHeading:function(){console.log("getHeading");return -1*(Math.atan2(-this.y,this.x))},magSq:function(){return this.x*this.x+this.y*this.y}});paper.Size.inject({area:function(){return(this.width*this.height)},radius:function(){var d=this.width;var c=this.height;return(Math.sqrt(d*d+c*c)/2)},diameter:function(){var d=this.width;var c=this.height;return(Math.sqrt(d*d+c*c))}});var folio=folio||{};folio={FTime:{},FIO:{},F3D:{},FPath:{},getAngle:function(b,a){return Math.atan2(a.y-b.y,a.x-b.x)*180/Math.PI},getSlopeAngle:function(a){return Math.atan(a.width/a.height)*180/Math.PI},getCommonTangents:function(f,d){var m=d.position.x-f.position.x;var l=d.position.y-f.position.y;var b=Math.sqrt(f.bounds.size.getArea());var a=Math.sqrt(d.bounds.size.getArea());b/=2;a/=2;var g=f.position.getDistance(d.position);if(g<=Math.abs(a-b)){return}var e=Math.atan2(l,m);var c=Math.acos((b-a)/g);var k=new Point(f.position.x+b*Math.cos(e+c),f.position.y+b*Math.sin(e+c));var j=new Point(d.position.x+a*Math.cos(e+c),d.position.y+a*Math.sin(e+c));var h=new Point(f.position.x+b*Math.cos(e-c),f.position.y+b*Math.sin(e-c));var i=new Point(d.position.x+a*Math.cos(e-c),d.position.y+a*Math.sin(e-c));return[k,j,i,h]},boolToInt:function(a){return(a)?1:0},getType:function(a){if(typeof a=="object"){if(a instanceof paper.Point){return"Point"}else{if(a instanceof paper.Size){return"Size"}else{if(a instanceof paper.Rectangle){return"Rectangle"}else{if(a instanceof Group){return"Group"}else{if(a instanceof paper.PlacedItem){return"PlacedItem"}else{if(a instanceof paper.Raster){return"Raster"}else{if(a instanceof paper.PlacedSymbol){return"PlacedSymbol"}else{if(a instanceof paper.Path){return"Path"}else{if(a instanceof paper.CompoundPath){return"CompoundPath"}else{if(a instanceof paper.Symbol){return"Symbol"}else{if(a instanceof paper.TextItem){return"TextItem"}else{return"undefined"}}}}}}}}}}}}else{return typeof a}},findByName:function(a,b){var e;for(var c=0;c<a.length;c++){var d=a[c];if(d.name==b){e=d}}return e},findById:function(a,e){var d;for(var b=0;b<a.length;b++){var c=a[b];if(c.id==e){d=c}}return d},alphabetical:function(d,c){d=d.toLowerCase();d=d.replace(/ä/g,"a");d=d.replace(/ö/g,"o");d=d.replace(/ü/g,"u");d=d.replace(/ß/g,"s");c=c.toLowerCase();c=c.replace(/ä/g,"a");c=c.replace(/ö/g,"o");c=c.replace(/ü/g,"u");c=c.replace(/ß/g,"s");return(d==c)?0:(d>c)?1:-1},distanceToCenter:function(d,c){var g=d.distanceToCenter();console.log(g);var f=c.distanceToCenter();console.log(f);var e=0;if(g>f){e=-1}else{if(g<f){e=1}}return e}};PaperScope.inject({enumerable:true,println:function(a){console.log(a);console.log("\n")},randomBias:function(d,c,a){var e=new Array(90,9,4,2.33,1.5,1,0.66,0.43,0.25,0.11,0.01);a=Math.max(0,Math.min(a,1))*10;var b=parseInt(Math.floor(a));var f=e[b];if(a<10){f+=(e[b+1]-f)*(a-b)}return Math.pow(Math.random(),f)*(c-d)+d}});Array.prototype.median=function(){var a=0;this.sort();if(this.length%2===0){a=(this[this.length/2-1]+this[this.length/2])/2}else{a=this[(this.length-1)/2]}return a};Array.prototype.unique=function(){var b=[];o:for(var c=0,e=this.length;c<e;c++){for(var a=0,d=b.length;a<d;a++){if(b[a]==this[c]){continue o}}b[b.length]=this[c]}return b};Array.prototype.merge=function(a){var b=this.concat(a);b.shuffle();return b};Array.prototype.max=function(d,c){d=(d!=undefined)?d:0;c=(c!=undefined)?c:this.length;var a=this[d];for(var b=(d+1);b<c;b++){if(this[b]>a){a=b}}return a};Array.prototype.min=function(d,c){d=(d!=undefined)?d:0;c=(c!=undefined)?c:this.length;var b=this[d];for(var a=(d+1);a<c;a++){if(this[a]<b){b=a}}return b};Array.prototype.shuffle=function(){for(var b,a,c=this.length;c;b=parseInt(Math.random()*c),a=this[--c],this[c]=this[b],this[b]=a){}};Array.prototype.removeDuplicates=function(){return this.reduce(function(a,b){if(a.indexOf(b)===-1){a.push(b)}return a},[])};Array.prototype.round=function(b){var c=Math.pow(10,b);for(var a=0;a<this.length;a++){this[a]=Math.round(this[a]*c)/c}return this};paper.Color.inject({componentToHex:function(a){var b=a.toString(16);return b.length==1?"0"+b:b},colorToHex:function(){var e,d,a;var f="";try{e=this.red*255;d=this.green*255;a=this.blue*255;f="#"+this.componentToHex(e)+this.componentToHex(d)+this.componentToHex(a)}catch(c){console.log(c)}return f},colorToInt:function(){var a;try{a=this.red;a=a<<8;a|=this.green;a=a<<8;a|=this.blue}catch(b){console.log(b);a=16777215}return a},integer:function(a){this.red=(a>>16)&255;this.green=(a>>8)&255;this.blue=a&255;return this},bytes:function(d,c,b,a){this.red=d/255;this.green=(c!=undefined)?c/255:d/255;this.blue=(b!=undefined)?b/255:d/255;this.alpha=(a!=undefined)?a/255:1;return this}});paper.Item.inject({snapGrid:function(a){this.position.snapGrid(a)},snapIso:function(a){this.position.snapIso(a)},toGroup:function(){if(folio.getType(this)=="CompoundPath"){return new Group(this.children)}else{return this}}});paper.Path.inject({statics:new function(){return{FArrow:function(f,c,j){var h=new Path.Line(f,c);j=(j!=undefined)?j:new Size(f.getDistance(c)*0.381924,f.getDistance(c)*0.381924);var b=Math.atan2(f.x-c.x,c.y-f.y);var e=[];e[0]=new Path.Line(new Point(0,0),new Point(-j.width,-j.height));e[1]=new Path.Line(new Point(0,0),new Point(j.width,-j.height));for(var d=0;d<e.length;d++){e[d].rotate(180+paper.degrees(b),new Point(0,0));e[d].translate(f)}var g=new Group([h,e[0],e[1]]);g.name="arrow";return g},FBubble:function(g,b,i,h){var j=new Path();j.name="bubble";i=(i!=undefined)?i:defaultFBubbleTagSize;if(b.width<10){b.width=10;i=new Size(10,10)}h=(h!=undefined)?h:"RANDOM";j.add(new Point(0,0));var d=180;var a=new Point(b.height/2+Math.cos(paper.radians(d))*(b.height),b.height/2+Math.sin(paper.radians(d))*(b.height));j.arcTo(a,new Point(0,b.height));var c=paper.randomInt(0,b.width-i.width);j.add(new Point(c,b.height));var f,e;if(h=="LEFT"){f=c}else{if(h=="CENTER"){f=c+(i.width/2)}else{if(h=="RIGHT"){f=c+i.width}else{f=paper.randomInt(c,c+i.width)}}}e=b.height+i.height;j.add(new Point(f,e));j.add(new Point(c+i.width,b.height));j.add(new Point(b.width,b.height));d=0;a=new Point(b.height/2+Math.cos(paper.radians(d))*(b.height/2),b.height/2+Math.sin(paper.radians(d))*(b.height/2));j.arcTo(new Point(b.width,0),false);j.closed=true;j.position=new Point(g.x,g.y+(i.height/2));return j},FChain:function(h,g,f,e){var d,c;if(h.type=="Point"){d=new Path.Circle(h,g);c=new Path.Circle(f,e)}else{d=h;c=g}var i=folio.getCommonTangents(d,c);var j=new Path();if(i!=null){j.name="chain";j.add(i[0]);j.add(i[1]);if(c.position.x>d.position.x){angle=0}else{if(c.position.y<d.position.y){angle=-90}else{if(c.position.y>d.position.y){angle=90}else{angle=180}}}var a=new Point(c.position.x+Math.cos(paper.radians(angle))*(c.bounds.width/2),c.position.y+Math.sin(paper.radians(angle))*(c.bounds.height/2));j.arcTo(a,i[2]);j.add(i[2]);j.add(i[3]);if(d.position.x>c.position.x){angle=0}else{if(d.position.y<c.position.y){angle=-90}else{if(d.position.y>c.position.y){angle=90}else{angle=180}}}var b=new Point(d.position.x+Math.cos(paper.radians(angle))*(d.bounds.width/2),d.position.y+Math.sin(paper.radians(angle))*(d.bounds.height/2));j.arcTo(b,i[0]);j.closed}return j},FCross:function(g,d,f,c){(f!=undefined)?f:1;(c!=undefined)?c:"LINE";var b,a;if(c=="LINE"){b=new Path.Line(g.x+d.width,g.y-d.height,g.x-d.width,g.y+d.height);b.strokeWidth=f;a=new Path.Line(g.x+d.width,g.y+d.height,g.x-d.width,g.y-d.height);a.strokeWidth=f}else{if(c=="SHARP"){b=new Path();b.add(new Point(g.x+d.width,g.y-d.height));b.add(new Point(g.x+d.width,(g.y-d.height)+(f/2)));b.add(new Point((g.x-d.width)+(f/2),g.y+d.height));b.add(new Point(g.x-d.width,g.y+d.height));b.add(new Point(g.x-d.width,(g.y+d.height)-(f/2)));b.add(new Point((g.x+d.width)-(f/2),g.y-d.height));b.closed=true;a=new Path();a.add(new Point(g.x-d.width,g.y-d.height));a.add(new Point((g.x-d.width)+(f/2),g.y-d.height));a.add(new Point(g.x+d.width,(g.y+d.height)-(f/2)));a.add(new Point(g.x+d.width,g.y+d.height));a.add(new Point((g.x+d.width)-(f/2),g.y+d.height));a.add(new Point(g.x-d.width,(g.y-d.height)+(f/2)));a.closed=true}}var e=new Group([b,a]);e.name="cross";return e},FDrop:function(d,a){var c=new Path();c.name="drop";c.add(new Segment(new Point(-0.01,0.01),new Point(0,-0.0055078),new Point(0,0.643042)));c.add(new Segment(new Point(-0.65,1.6381104),new Point(0,-0.6109619),new Point(0,0.3694434)));c.add(new Segment(new Point(0,2.31),new Point(-0.3578369,0),new Point(0.3578369,0)));c.add(new Segment(new Point(0.65,1.6381104),new Point(0,0.3694434),new Point(0,-0.6109619)));c.add(new Segment(new Point(0.01,0.01),new Point(0,0.643042),new Point(0,-0.0055078)));c.add(new Segment(new Point(0,-0),new Point(0.0055078,0),new Point(-0.0055078,0)));c.closed=true;c.position=d;var b=folio.getType(a);if(b=="Size"){c.scale(a.width,a.height)}else{c.scale(a)}return c},FTriangle:function(d,c,a){var b=new Path();b.add(d);b.add(c);b.add(a);b.closed=true;b.name="triangle";return b}}}});paper.Point.inject({name:null,data:{},snap:function(d,c){c=(c!=undefined)?c:{grid:true,isometric:false};d=(d.type=="Size")?d:new Size(d,d);var b,a;if(optons.isometric===true){b=Math.round(this.y/(16*d.height)-this.x/(32*d.width));a=Math.round(this.y/(16*d.height)+this.x/(16*d.width));this.x=(a-b)/2*(32*d.width);this.y=(a+b)/2*(16*d.height)}else{b=Math.round(this.y/d.height-this.x/d.width);a=Math.round(this.y/d.height+this.x/d.width);this.x=(a-b)/2*d.width;this.y=(a+b)/2*d.height}return this}});String.prototype.rtrim=function(){for(var a=str.length-1;str.charAt(a)==" ";a--){str=str.substring(0,a)}return str};String.prototype.trim=function(){str=str.replace(/(^\s*)|(\s*$)/gi,"");str=str.replace(/[ ]{2,}/gi," ");str=str.replace(/\n /,"\n");return str};String.prototype.toBool=function(){switch(this.toLowerCase()){case"true":case"yes":case"1":return true;case"false":case"no":case"0":case null:return false;default:return Boolean(this)}};paper.TextItem.inject({trimToFit:function(){var a=this.visibleRange.content.trim();this.content=a;return this}});folio.FIO={saveLocal:function(a,b){if(window.localStorage){localStorage.setItem(a,String(b))}else{console.error("localStorage not supported")}},getLocal:function(a){return localStorage.getItem(a)},getLocalInt:function(a){return parseInt(getLocal(a))},getLocalFloat:function(a){return parseFloat(getLocal(a))},getAllLocal:function(){return sessionStorage},deleteLocal:function(a){localStorage.removeItem(a)},saveSession:function(a,b){if(window.sessionStorage){sessionStorage.setItem(a,String(b))}else{console.error("sessionStorage not supported")}},getSession:function(a){return sessionStorage.getItem(a)},getSessionInt:function(a){return parseInt(getSession(a))},getSessionFloat:function(a){return parseFloat(getSession(a))},getAllSession:function(){return sessionStorage},deleteSession:function(a){sessionStorage.removeItem(a)},saveCookie:function(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"},openCookie:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null},deleteCookie:function(a){saveCookie(a,"",-1)}};folio.FTime={FDate:{},FStopwatch:{},FStepper:{},Ease:{}};folio.FTime.Ease=function(){var a={ease:[0.25,0.1,0.25,1],linear:[0,0,1,1],out:[0,0,0.58,1],inOut:[0.42,0,0.58,1]};function b(i,h){var k;if(i instanceof Array){k=i}else{i=i.normalize();h=h.normalize();k=[i.x,i.y,h.x,h.y]}function f(n,m){return 1-3*m+3*n}function e(n,m){return 3*m-6*n}function c(m){return 3*m}function d(p,n,m){return((f(n,m)*p+e(n,m))*p+c(n))*p}function l(p,n,m){return 3*f(n,m)*p*p+2*e(n,m)*p+c(n)}function j(q){var n=q;for(var p=0;p<4;++p){var r=l(n,k[0],k[2]);if(r==0){return n}var m=d(n,k[0],k[2])-q;n-=m/r}return n}function g(m){if(k[0]==k[1]&&k[2]==k[3]){return m}return d(j(m),k[1],k[3])}return{get:g}}return{linear:function(c){return c},inQuad:function(c){return c*c},outQuad:function(c){return c*(2-c)},inOutQuad:function(c){return c<0.5?2*c*c:-1+(4-2*c)*c},inCubic:function(c){return c*c*c},outCubic:function(c){return(--c)*c*c+1},inOutCubic:function(c){return c<0.5?4*c*c*c:(c-1)*(2*c-2)*(2*c-2)+1},inQuart:function(c){return c*c*c*c},outQuart:function(c){return 1-(--c)*c*c*c},inOutQuart:function(c){return c<0.5?8*c*c*c*c:1-8*(--c)*c*c*c},inQuint:function(c){return c*c*c*c*c},outQuint:function(c){return 1+(--c)*c*c*c*c},inOutQuint:function(c){return c<0.5?16*c*c*c*c*c:1+16*(--c)*c*c*c*c},inSine:function(c){return -1*Math.cos(c*(Math.PI/2))+1},outSine:function(c){return 1*Math.sin(c*(Math.PI/2))},inOutSine:function(c){return -0.5*(Math.cos(Math.PI*c)-1)},inExpo:function(c){return 1*Math.pow(2,10*(c-1))},outExpo:function(c){return 1*(-Math.pow(2,-10*c)+1)},inOutExpo:function(c){c/=0.5;if(c<1){return 0.5*Math.pow(2,10*(c-1))}c--;return 0.5*(-Math.pow(2,-10*c)+2)},inCirc:function(c){return -1*(Math.sqrt(1-c*c)-1)},outCirc:function(c){c--;return 1*Math.sqrt(1-c*c)},inOutCirc:function(c){c/=0.5;if(c<1){return -0.5*(Math.sqrt(1-c*c)-1)}else{c-=2;return 0.5*(Math.sqrt(1-c*c)+1)}},spline:b}};folio.FTime.FDate=function(){this.date;var b=["January","February","March","April","May","June","July","August","September","October","November","December"];var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var c=function(d){if(d.length==1){d="0"+d}return d};this.year=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getFullYear());return d};this.month=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getMonth());hour=c(d);return d};this.day=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getDate());return d};this.hour=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getHours());d=c(d);return d};this.minute=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getMinutes());d=c(d);return d};this.second=function(){if(this.date===undefined){this.date=new Date()}var d=String(this.date.getSeconds());d=c(d);return d};this.now=function(e){var d=[];if(e===undefined){d=[true,true,true]}else{d=e}var f="";if(d[0]){f+=this.hour()}if(d[0]&&d[1]){f+=":"}if(d[1]){f+=this.minute()}if(d[1]&&d[2]){f+=":"}if(d[2]){f+=this.second()}return f};this.nowMilliseconds=function(){return this.toMillsecond(this.hour(),this.minute(),this.second())};this.add=function(d,g,e,f){return this.date+(24*d+60*g+60*e+1000*s)};this.sub=function(d,g,e,f){return this.date-(24*d+60*g+60*e+1000*s)};this.set=function(d,g,e,f){this.time=new Date();this.time.setTime((24*d+60*g+60*e+1000*s));return this.time};this.get=function(d,k){var l;if(k===undefined){l=new Array(true,true,true)}else{l=k}var j=parseInt((d/1000)%60);var g=parseInt(((d/1000)/60)%60);var i=parseInt((((d/1000)/60)/60)%24);var e,f,m;if(i<10){e="0"+i}else{e=""+i}if(g<10){f="0"+g}else{f=""+g}if(j<10){m="0"+j}else{m=""+j}var h="";if(l[0]){h+=e}if(l[0]&&l[1]){h+=":"}if(l[1]){h+=f}if(l[1]&&l[2]){h+=":"}if(l[2]){h+=m}return h};this.toMillsecond=function(j,e,i){var g,d,f;if(e===undefined&&i===undefined){g=this.toArray(j)[0];d=this.toArray(j)[1];f=this.toArray(j)[2]}else{g=j;d=e;f=i}return parseInt(3600000*g+60000*d+1000*f)};this.toArray=function(d){var e=d.split(":");return[e[0],e[1],e[2]]}};folio.FTime.FStepper=function(){var e=1000;var f=0;var h=0;var j=0;var i=false;var c=false;var g=false;var d=true;var a=0.05;var b=true;this.delta=1;this.counter=-1;this.toggle=function(){if(j==0){j=1;this.stepOut()}else{j=0;this.stepIn()}};this.update=function(k){if(i){i=false;f=k;if(c){h=paper.round((k+((1-this.delta)*e)),3)}else{h=paper.round((k+(this.delta*e)),3)}if(h<=k){if(c){c=false;this.delta=1}else{g=false;this.delta=0}}}if(c){this.delta=paper.round((1-((h-k)/e)),3);if(k==h){c=false;this.delta=1;this.counter++;return}}else{if(g){this.delta=paper.round(((h-k)/e),3);if(k==h){c=false;this.delta=0;this.counter++;return}}}};this.stepIn=function(){if(c){return}if(this.delta==1){return}i=true;c=true;g=false};this.stepOut=function(){if(g){return}if(this.delta==0){return}i=true;g=true;c=false};this.isIn=function(){return c};this.isOut=function(){return g};this.isDone=function(){if(this.delta<1&&this.delta>0){return false}else{if(this.delta>1){this.delta=1;return true}else{if(this.delta<0){this.delta=0;return true}}}};this.stop=function(){i=c=g=false};this.setSeconds=function(k){this.setMillis(parseInt(k*1000))};this.setMillis=function(k){e=k;e/=1000};this.setDelta=function(k){this.delta=k}};folio.FTime.FStopwatch=function(){var c;var d;var b=0;var a=0;this.toggle=function(){if(a==0){this.start()}else{this.pause()}};this.start=function(){a=1;d=new Date();d.setTime(d.getTime()-b)};this.pause=function(){a=0;c=new Date();b=c.getTime()-d.getTime()};this.reset=function(){a=0;b=0};this.set=function(e,f){b=e;(f==true)?a=0:a=1;d=new Date();d.setTime(d.getTime()-b);this.toggle()};this.get=function(){if(a==1){c=new Date();b=c.getTime()-d.getTime()}return b};this.isRunning=function(){return(a)?true:false}};folio.FRoute=function(a,d){var a=a;var d=(d!=undefined)?d:1000;var b=0;var e=[];function c(){var D;var g;if(b==0){var t=0;var n=new Array(a.length);for(var A=0;A<a.length;++A){n[A]=false;var v=a[A].position.x;var u=a[A].position.y;if((v>=view.bounds.width)||(u>=view.bounds.height)||(v<0)||(u<0)){continue}else{n[A]=true;t++}}e=new Array(t);var C=0;for(var A=0;A<a.length;++A){if(n[A]){e[C]=A;C++}}}var w=e.length-1;if(b<(e.length-2)){var E=b+1000;if(E>w){E=w}for(var A=b;A<E;++A){g=a[e[b]].position;var B=0;var h=Number.MAX_VALUE;for(var z=b+1;z<w;++z){var f=a[e[z]].position;var r=g.x-f.x;var q=g.y-f.y;var k=(r*r+q*q);if(k<h){B=z;h=k}}D=e[b+1];e[b+1]=e[B];e[B]=D;if(b<(w)){b++}else{console.log("Now optimizing plot path")}}}for(var A=0;A<d;++A){var G=Math.floor(random(0,w));var F=Math.floor(random(0,w));if(Math.abs(G-F)<2){continue}if(F<G){D=F;F=G;G=D}var I=a[e[G]].position;var H=a[e[G+1]].position;var p=a[e[F]].position;var m=a[e[F+1]].position;var r=I.x-H.x;var q=I.y-H.y;var k=(r*r+q*q);r=p.x-m.x;q=p.y-m.y;k+=(r*r+q*q);r=I.x-p.x;q=I.y-p.y;var x=(r*r+q*q);r=H.x-m.x;q=H.y-m.y;x+=(r*r+q*q);if(x<k){var l=F;var y=G+1;while(l>y){D=e[y];e[y]=e[l];e[l]=D;l--;y++}}}}c();return{route:e}};var EPSILON=0.000001;folio.FTriangulate=function(n){var d;var e=n;var q=[];var b=function(E,C,B){var y=E;var x=C;var w=B;function z(G){return E==G.p1||E==G.p2||E==G.p3||C==G.p1||C==G.p2||C==G.p3||B==G.p1||B==G.p2||B==G.p3}function F(){var L=new Point();var H,G;var J,I;var M,K;if(Math.abs(x.y-y.y)<EPSILON){G=-(w.x-x.x)/(w.y-x.y);I=(x.x+w.x)/2;K=(x.y+w.y)/2;L.x=(x.x+y.x)/2;L.y=G*(L.x-I)+K}else{if(Math.abs(w.y-x.y)<EPSILON){H=-(x.x-y.x)/(x.y-y.y);J=(y.x+x.x)/2;M=(y.y+x.y)/2;L.x=(w.x+x.x)/2;L.y=H*(L.x-J)+M}else{H=-(x.x-y.x)/(x.y-y.y);G=-(w.x-x.x)/(w.y-x.y);J=(y.x+x.x)/2;I=(x.x+w.x)/2;M=(y.y+x.y)/2;K=(x.y+w.y)/2;L.x=(H*J-G*I+K-M)/(H-G);L.y=H*(L.x-J)+M}}return L}function u(){return new Point((y.x+x.x+w.x)/3,(y.y+x.y+w.y)/3)}function A(){var G=[];G[0]=new i(y,x);G[1]=new i(y,w);G[2]=new i(w,x);G.sort();return G}function t(){var H=0;if(y.x<x.x&&y.x<w.x){H=y.x}else{if(x.x<y.x&&x.x<w.x){H=x.x}else{if(w.x<y.x&&w.x<x.x){H=w.x}}}var G=0;if(y.x>x.x&&y.x>w.x){G=y.x}else{if(x.x>y.x&&x.x>w.x){G=x.x}else{if(w.x>y.x&&w.x>x.x){G=w.x}}}var I=Math.abs(G-H);return I}function D(){var H=0;if(y.y<x.y&&y.y<w.y){H=y.y}else{if(x.y<y.y&&x.y<w.y){H=x.y}else{if(w.y<y.y&&w.y<x.y){H=w.y}}}var G=0;if(y.y>x.y&&y.y>w.y){G=y.y}else{if(x.y>y.y&&x.y>w.y){G=x.y}else{if(w.y>y.y&&w.y>x.y){G=w.y}}}var I=Math.abs(G-H);return I}function r(){var G=0;G+=(y.x+w.x)*(w.y-y.y);G+=(x.x+y.x)*(y.y-x.y);G+=(w.x+x.x)*(x.y-w.y);return G/2}function v(){var G=[y,x,w];return G}return{p1:y,p2:x,p3:w,sharesVertex:z,getCentroid:u,getArea:r,getWidth:t,getHeight:D,getPoints:v}};var i=function(y,x){var v=y;var r=x;var w=v.getDistance(r);function u(z){return w<z.dist?-1:w>z.dist?1:0}function t(){var z=[v,r];return z}return{p1:v,p2:r,dist:w,getPoints:t}};function p(){d=[];if(e.length!=null){e=k(e);e.sort(f);var D=(e[0]).x;var I=(e[0]).y;var F=D;var M=I;var x=(e[0]).z;for(var K=0;K<e.length;K++){var E=e[K];if(E.x<D){D=E.x}if(E.x>F){F=E.x}if(E.y<I){I=E.y}if(E.y>M){M=E.y}}var A=F-D;var y=M-I;var G=(A>y)?A:y;var L=(F+D)/2;var Q=(M+I)/2;d=[];var C=new HashSet();var O=new b(new Point(L-2*G,Q-G),new Point(L,Q+2*G),new Point(L+2*G,Q-G));d.push(O);var r=[];for(var K=0;K<e.length;K++){var E=e[K];r=[];var u=new Point();for(var J=d.length-1;J>=0;J--){var B=d[J];if(C.contains(B)){continue}var N=c(E,B,u);if(u.x+u.z<E.x){C.add(B)}if(N){r.push(new i(B.p1,B.p2));r.push(new i(B.p2,B.p3));r.push(new i(B.p3,B.p1));d.splice(J,1)}}r=h(r);for(var J=0;J<r.length-1;J++){var w=r[J];for(var H=J+1;H<r.length;H++){var v=r[H];if(w.p1==v.p2&&w.p2==v.p1){w.p1=null;w.p2=null;v.p1=null;v.p2=null}if(w.p1==v.p1&&w.p2==v.p2){w.p1=null;w.p2=null;v.p1=null;v.p2=null}}}for(var J=0;J<r.length;J++){var P=r[J];if(P.p1==null||P.p2==null){continue}for(var H=0;H<q.length;H++){if(P.p1==q[H]){P.p1.name="__new"}else{P.p1.name=null}if(P.p2==q[H]){P.p2.name="__new"}else{P.p2.name=null}if(E==q[H]){E.name="__new"}else{E.name=null}}d.push(new b(P.p1,P.p2,E))}}for(var K=d.length-1;K>=0;K--){var B=d[K];if(B.sharesVertex(O)){d.splice(K,1)}}}}function c(u,C,r){var D,A;var z,y;var x,w;var F,B;var E;var v;if(Math.abs(C.p1.y-C.p2.y)<EPSILON&&Math.abs(C.p2.y-C.p3.y)<EPSILON){return false}if(Math.abs(C.p2.y-C.p1.y)<EPSILON){A=-(C.p3.x-C.p2.x)/(C.p3.y-C.p2.y);y=(C.p2.x+C.p3.x)/2;w=(C.p2.y+C.p3.y)/2;r.x=(C.p2.x+C.p1.x)/2;r.y=A*(r.x-y)+w}else{if(Math.abs(C.p3.y-C.p2.y)<EPSILON){D=-(C.p2.x-C.p1.x)/(C.p2.y-C.p1.y);z=(C.p1.x+C.p2.x)/2;x=(C.p1.y+C.p2.y)/2;r.x=(C.p3.x+C.p2.x)/2;r.y=D*(r.x-z)+x}else{D=-(C.p2.x-C.p1.x)/(C.p2.y-C.p1.y);A=-(C.p3.x-C.p2.x)/(C.p3.y-C.p2.y);z=(C.p1.x+C.p2.x)/2;y=(C.p2.x+C.p3.x)/2;x=(C.p1.y+C.p2.y)/2;w=(C.p2.y+C.p3.y)/2;r.x=(D*z-A*y+w-x)/(D-A);r.y=D*(r.x-z)+x}}F=C.p2.x-r.x;B=C.p2.y-r.y;E=F*F+B*B;r.z=Math.sqrt(E);F=u.x-r.x;B=u.y-r.y;v=F*F+B*B;return v<=E}function l(t){var r;for(var w=0;w<d.length;w++){var z=d[w];var y=t.getCentroid.getDistance(z.getCentroid);for(var u=0;u<d.length;u++){var v=d[u];var x=t.getCentroid.getDistance(v.getCentroid);if(x<y){r=v;break}}}return r}function f(t,r){if(t.x<r.x){return 1}else{if(t.x>r.x){return -1}else{return 0}}}function j(t,r){if(t.y<r.y){return 1}else{if(t.y>r.y){return -1}else{return 0}}}function k(r){r.sort();for(var t=1;t<r.length;){if(r[t-1].x==r[t].x&&r[t-1].y==r[t].y){r.splice(t,1)}else{t++}}return r}function h(r){r.sort();for(var t=1;t<r.length;){if(r[t-1].p1==r[t].p1&&r[t-1].p2==r[t].p2||r[t-1].p1==r[t].p2&&r[t-1].p2==r[t].p2){r.splice(t,1)}else{t++}}return r}function a(r){q=[];if(r instanceof Array){q=r;e=e.concat(r)}else{q[0]=r;e.push(r)}e=k(e);p()}function m(r){if(r!=null){return d[r]}else{return d}}function g(r){if(r!=null){return e[r]}else{return e}}p();return{add:a,getTriangles:m,getPoints:g,getClosest:l}};var HashSet=function(){var a=new Array();function g(k){var h=a;var j=h.indexOf(k);if(j==-1){h.push(k)}}function d(h){return a[h]}function b(h){return a.length}function c(k){var h=a;var j=h.indexOf(k);if(j!=-1){h.splice(j,1)}}function e(k){var h=false;for(var j=0;j<a.length;j++){if(a[j]===k){h=true}}return h}function f(){return a.join(",")}return{add:g,get:d,size:b,remove:c,contains:e,toString:f}};